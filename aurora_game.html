<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora Adventure Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Cosmic Glow -->
    <!-- Application Structure Plan: The application is structured as a linear, multi-level game. This sequential flow (Start Screen -> Level 1 -> Level 2 -> Level 3 -> End Screen) is ideal for teaching a process-based topic like aurora formation to children. Each level builds upon the previous one, creating a narrative journey from the sun to the Earth's atmosphere. This step-by-step approach simplifies complex concepts and uses interactive tasks instead of quizzes to promote learning through play. Pop-up modals between levels serve as positive reinforcement and clear transition points. -->
    <!-- Visualization & Content Choices: The game uses an HTML Canvas for interactive visualizations. Level 1 (Solar Wind) uses particle animation to teach about solar emissions. Goal: Inform. Interaction: Click to release particles. Justification: Actively engaging the user makes the abstract concept of solar wind more tangible. Level 2 (Magnetic Shield) uses interactive deflection lines to explain the magnetosphere. Goal: Demonstrate a concept. Interaction: Click to activate a shield. Justification: Visualizing the invisible magnetic field provides a powerful "aha!" moment. Level 3 (Create an Aurora) uses a drag-and-drop mechanic to show particle collisions. Goal: Explain a cause-and-effect relationship. Interaction: Drag particles to gas atoms. Justification: This directly simulates the final step of aurora creation, solidifying the learning objective. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0c0a1a;
            background-image: url('https://images.unsplash.com/photo-1531366936337-7c912a4589a7?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        .glass-panel {
            background: rgba(12, 10, 26, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
        }
        .btn-primary {
            background-image: linear-gradient(to right, #4f46e5, #c026d3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(192, 38, 211, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(192, 38, 211, 0.5);
        }
        .modal-container {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        canvas {
            cursor: pointer;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-4xl mx-auto">

        <!-- Start Screen -->
        <div id="start-screen" class="text-center glass-panel p-8 md:p-12">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-green-300 via-blue-400 to-purple-500">Aurora Adventure</h1>
            <p class="text-lg md:text-xl mb-8 text-gray-200">Welcome, Space Explorer! Let's learn how the beautiful northern lights are created. Are you ready for an adventure?</p>
            <button id="start-btn" class="btn-primary text-white font-bold py-3 px-8 rounded-full text-xl">Start Adventure</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden glass-panel p-4 sm:p-6">
            <div class="flex justify-between items-center mb-4 px-2">
                <h2 id="level-title" class="text-2xl font-bold">Level 1: The Solar Wind</h2>
                <div class="text-lg font-semibold">Level <span id="level-indicator">1</span>/3</div>
            </div>
            <p id="level-instruction" class="text-center mb-4 text-gray-300 text-sm md:text-base"></p>
            <div class="relative w-full aspect-[16/9] bg-black/30 rounded-2xl overflow-hidden">
                <canvas id="game-canvas"></canvas>
            </div>
        </div>

        <!-- Modal Popup -->
        <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-container">
            <div class="glass-panel text-center p-8 md:p-12 m-4 max-w-lg">
                <div id="modal-icon" class="text-6xl mb-4">✨</div>
                <h3 id="modal-title" class="text-3xl font-bold mb-4">Level Complete!</h3>
                <p id="modal-text" class="text-lg mb-8">You did an amazing job!</p>
                <button id="next-level-btn" class="btn-primary text-white font-bold py-3 px-8 rounded-full text-xl">Next Level</button>
            </div>
        </div>

    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const startBtn = document.getElementById('start-btn');
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        const levelTitle = document.getElementById('level-title');
        const levelIndicator = document.getElementById('level-indicator');
        const levelInstruction = document.getElementById('level-instruction');

        const modal = document.getElementById('modal');
        const modalIcon = document.getElementById('modal-icon');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const nextLevelBtn = document.getElementById('next-level-btn');

        let currentLevel = 1;
        let animationFrameId;

        const levels = {
            1: {
                title: 'The Solar Wind',
                instruction: 'The Sun sends out tiny, super-fast particles called the Solar Wind. Click on the Sun to send them flying!',
                setup: setupLevel1,
                cleanup: cleanupLevel1
            },
            2: {
                title: 'Earth\'s Shield',
                instruction: 'Earth has an invisible shield called the Magnetosphere that protects us. Click Earth to activate the shield and deflect the particles!',
                setup: setupLevel2,
                cleanup: cleanupLevel2
            },
            3: {
                title: 'Create the Aurora!',
                instruction: 'Some particles get trapped and head to the poles. Drag these particles to the colorful gas atoms to make the sky glow!',
                setup: setupLevel3,
                cleanup: cleanupLevel3
            }
        };

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        function showScreen(screen) {
            startScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            screen.classList.remove('hidden');
        }

        function startGame() {
            showScreen(gameScreen);
            loadLevel(currentLevel);
        }

        function loadLevel(level) {
            if (levels[level].cleanup) levels[level-1]?.cleanup();
            if (animationFrameId) cancelAnimationFrame(animationFrameId);

            levelTitle.textContent = levels[level].title;
            levelIndicator.textContent = level;
            levelInstruction.textContent = levels[level].instruction;

            resizeCanvas();
            levels[level].setup();
        }
        
        function completeLevel() {
            modal.classList.remove('hidden');
            if (currentLevel < 3) {
                modalIcon.textContent = '✨';
                modalTitle.textContent = 'Awesome!';
                modalText.textContent = `You've completed Level ${currentLevel}! You're a natural space scientist.`;
                nextLevelBtn.textContent = 'Next Level';
            } else {
                modalIcon.textContent = '🏆';
                modalTitle.textContent = 'You are an Aurora Master!';
                modalText.textContent = 'You\'ve learned the secret of the northern lights! Great job, Space Explorer!';
                nextLevelBtn.textContent = 'Play Again';
            }
        }
        
        function handleNextAction() {
            modal.classList.add('hidden');
            currentLevel++;
            if (currentLevel > 3) {
                currentLevel = 1;
                showScreen(startScreen);
            } else {
                loadLevel(currentLevel);
            }
        }

        startBtn.addEventListener('click', startGame);
        nextLevelBtn.addEventListener('click', handleNextAction);
        window.addEventListener('resize', () => {
             if (!gameScreen.classList.contains('hidden')) {
                resizeCanvas();
                loadLevel(currentLevel);
             }
        });

        let particles1 = [];
        let sun = {};
        
        function setupLevel1() {
            sun = { x: canvas.width * 0.1, y: canvas.height / 2, radius: 40 };
            particles1 = [];
            canvas.onclick = (e) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                if (Math.hypot(mouseX - sun.x, mouseY - sun.y) < sun.radius) {
                    for (let i = 0; i < 20; i++) {
                        particles1.push({
                            x: sun.x,
                            y: sun.y,
                            vx: 3 + Math.random() * 3,
                            vy: (Math.random() - 0.5) * 2,
                            radius: Math.random() * 2 + 1,
                            color: 'rgba(255, 255, 0, 0.8)'
                        });
                    }
                }
            };
            animateLevel1();
        }

        function animateLevel1() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#f97316';
            ctx.beginPath();
            ctx.arc(sun.x, sun.y, sun.radius, 0, Math.PI * 2);
            ctx.fill();

            for (let i = particles1.length - 1; i >= 0; i--) {
                const p = particles1[i];
                p.x += p.vx;
                p.y += p.vy;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                if (p.x > canvas.width) particles1.splice(i, 1);
            }
            
            if (particles1.length > 50) { 
                completeLevel();
            } else {
                animationFrameId = requestAnimationFrame(animateLevel1);
            }
        }
        
        function cleanupLevel1() {
            canvas.onclick = null;
        }

        let particles2 = [];
        let earth2 = {};
        let shieldActive = false;

        function setupLevel2() {
            earth2 = { x: canvas.width * 0.8, y: canvas.height / 2, radius: 50 };
            shieldActive = false;
            particles2 = [];
            for (let i = 0; i < 100; i++) {
                 particles2.push({
                    x: -Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: 4 + Math.random() * 2,
                    radius: Math.random() * 2 + 1
                });
            }
            canvas.onclick = (e) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                if (Math.hypot(mouseX - earth2.x, mouseY - earth2.y) < earth2.radius) {
                    shieldActive = true;
                }
            };
            animateLevel2();
        }
        
        function animateLevel2() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            ctx.arc(earth2.x, earth2.y, earth2.radius, 0, Math.PI * 2);
            ctx.fill();
            
            if (shieldActive) {
                ctx.strokeStyle = 'rgba(132, 204, 22, 0.7)';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(earth2.x, earth2.y, earth2.radius + 20, -Math.PI/2, Math.PI/2);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(earth2.x, earth2.y, earth2.radius + 40, -Math.PI/2, Math.PI/2);
                ctx.stroke();
            }

            let deflectedCount = 0;
            for (let i = particles2.length - 1; i >= 0; i--) {
                const p = particles2[i];
                p.x += p.vx;

                if (shieldActive && Math.abs(p.y - earth2.y) < earth2.radius + 45 && p.x > earth2.x - earth2.radius - 45 && p.x < earth2.x) {
                    p.vx *= -0.5;
                    p.vy = (p.y > earth2.y ? 1 : -1) * 3;
                    deflectedCount++;
                }
                
                if (p.vy) p.y += p.vy;

                ctx.fillStyle = 'rgba(255, 255, 0, 0.8)';
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();

                if (p.x > canvas.width || p.x < -10 || p.y > canvas.height || p.y < 0) particles2.splice(i, 1);
            }

            if(shieldActive && particles2.length === 0){
                completeLevel();
            } else {
                animationFrameId = requestAnimationFrame(animateLevel2);
            }
        }
        
        function cleanupLevel2(){
            canvas.onclick = null;
        }


        let particles3 = [];
        let atoms = [];
        let earth3 = {};
        let draggingParticle = null;

        function setupLevel3() {
            earth3 = { x: canvas.width / 2, y: canvas.height * 1.5, radius: canvas.width };
            particles3 = [];
            atoms = [];
            
            for (let i = 0; i < 5; i++) {
                particles3.push({
                    x: canvas.width / 2 + (Math.random() - 0.5) * 50,
                    y: -20 - Math.random() * 50,
                    radius: 8,
                    color: 'yellow',
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: 0.5 + Math.random() * 0.5
                });
            }

            for (let i = 0; i < 15; i++) {
                atoms.push({
                    x: Math.random() * canvas.width * 0.8 + canvas.width * 0.1,
                    y: canvas.height * 0.4 + Math.random() * canvas.height * 0.5,
                    radius: 12,
                    color: Math.random() > 0.5 ? '#ef4444' : '#22c55e', // Red for Oxygen, Green for Nitrogen
                    activated: false,
                    alpha: 0
                });
            }
            
            canvas.onmousedown = (e) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                for (const p of particles3) {
                    if (Math.hypot(mouseX - p.x, mouseY - p.y) < p.radius) {
                        draggingParticle = p;
                        break;
                    }
                }
            };
            
            canvas.onmousemove = (e) => {
                if (draggingParticle) {
                    const rect = canvas.getBoundingClientRect();
                    draggingParticle.x = e.clientX - rect.left;
                    draggingParticle.y = e.clientY - rect.top;
                }
            };

            canvas.onmouseup = () => {
                draggingParticle = null;
            };
            
            animateLevel3();
        }

        function animateLevel3() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            let grd = ctx.createRadialGradient(earth3.x, earth3.y, earth3.radius - 100, earth3.x, earth3.y, earth3.radius);
            grd.addColorStop(0, '#3b82f6');
            grd.addColorStop(1, '#0c0a1a');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let allActivated = true;
            atoms.forEach(atom => {
                if (atom.activated) {
                    atom.alpha = Math.min(1, atom.alpha + 0.05);
                    ctx.beginPath();
                    ctx.arc(atom.x, atom.y, atom.radius * 2.5, 0, Math.PI * 2);
                    let glow = ctx.createRadialGradient(atom.x, atom.y, 0, atom.x, atom.y, atom.radius * 2.5);
                    glow.addColorStop(0, `${atom.color}ff`);
                    glow.addColorStop(1, `${atom.color}00`);
                    ctx.fillStyle = glow;
                    ctx.globalAlpha = atom.alpha;
                    ctx.fill();
                    ctx.globalAlpha = 1;
                } else {
                    allActivated = false;
                    ctx.fillStyle = atom.color;
                    ctx.beginPath();
                    ctx.arc(atom.x, atom.y, atom.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            particles3.forEach(p => {
                if (p !== draggingParticle) {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.y > canvas.height || p.x < 0 || p.x > canvas.width) {
                        p.y = -20;
                        p.x = canvas.width / 2 + (Math.random() - 0.5) * 50;
                    }
                }
                
                atoms.forEach(atom => {
                    if (!atom.activated && Math.hypot(p.x - atom.x, p.y - atom.y) < p.radius + atom.radius) {
                        atom.activated = true;
                        p.y = -100; // Reset particle
                    }
                });
                
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
            });

            if (allActivated) {
                completeLevel();
            } else {
                animationFrameId = requestAnimationFrame(animateLevel3);
            }
        }
        
        function cleanupLevel3() {
            canvas.onmousedown = null;
            canvas.onmousemove = null;
            canvas.onmouseup = null;
        }

    </script>
</body>
</html>